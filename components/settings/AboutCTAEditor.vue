<template>
  <div class="relative"><div class="absolute top-4 left-4 z-20 flex items-center gap-2"><span class="bg-blue-600 text-white px-3 py-1 rounded-full text-sm font-medium shadow-lg">Call-to-Action</span><button @click="toggleVisibility" class="p-2 rounded-full shadow-lg transition-colors" :class="sectionData.is_active ? 'bg-green-500 text-white' : 'bg-gray-500 text-white'"><Icon :name="sectionData.is_active ? 'heroicons-outline:eye' : 'heroicons-outline:eye-off'" class="w-4 h-4" /></button></div><section class="py-20 bg-gradient-to-br from-primary-600 to-primary-800"><div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center"><input v-model="currentContent.title" type="text" class="text-4xl font-bold text-white bg-transparent border-2 border-transparent hover:border-white/30 focus:border-white/50 rounded-lg px-4 py-2 text-center outline-none w-full mb-6" placeholder="Titre" /><textarea v-model="currentContent.content" rows="2" class="text-lg text-white/90 bg-transparent border-2 border-transparent hover:border-white/30 focus:border-white/50 rounded-lg px-4 py-2 text-center outline-none w-full resize-none mb-8" placeholder="Description"></textarea><div class="flex justify-center gap-4"><input v-model="buttonData[`button_text_${editorLanguage}`]" type="text" class="px-8 py-3 bg-white text-primary-700 font-medium rounded-full border-2 border-transparent hover:border-primary-200 focus:border-primary-300 outline-none" placeholder="Texte du bouton" /><input v-model="buttonData.button_url" type="text" class="px-6 py-3 bg-primary-700 text-white rounded-full border-2 border-transparent hover:border-white/30 focus:border-white/50 outline-none" placeholder="/url" /></div></div></section></div>
</template>
<script setup>
const { fetchSectionByKey } = useAboutUs(); const { editorLanguage } = useEditorLanguage(); const supabase = useSupabaseClient(); const sectionData = ref({ section_key: 'about_cta', is_active: true, title_translations: {}, content_translations: {}, additional_data: {} }); const currentContent = computed({ get: () => ({ title: sectionData.value.title_translations?.[editorLanguage.value] || '', content: sectionData.value.content_translations?.[editorLanguage.value] || '' }), set: (val) => { sectionData.value.title_translations[editorLanguage.value] = val.title; sectionData.value.content_translations[editorLanguage.value] = val.content } }); const buttonData = computed(() => sectionData.value.additional_data || {}); const loadData = async () => { try { const { data } = await fetchSectionByKey('about_cta'); if (data) sectionData.value = data } catch (error) { console.error(error) } }; const save = async () => { try { const { error } = await supabase.from('about_us_sections').update({ title_translations: sectionData.value.title_translations, content_translations: sectionData.value.content_translations, additional_data: sectionData.value.additional_data, is_active: sectionData.value.is_active }).eq('section_key', 'about_cta'); if (error) throw error } catch (error) { console.error(error); throw error } }; const toggleVisibility = async () => { sectionData.value.is_active = !sectionData.value.is_active; await save() }; onMounted(loadData); watch(editorLanguage, loadData); defineExpose({ save })
</script>